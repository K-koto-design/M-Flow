 <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Админка (Ссылки) - Music Cloud</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; padding: 20px; display: flex; justify-content: center; }
        .upload-form { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn { background: #1DB954; color: white; border: none; padding: 15px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; }
        label { font-size: 12px; color: #666; font-weight: bold; }
    </style>
</head>
<body>

<div class="upload-form">
    <h2>Добавить трек по ссылкам</h2>
    <input type="text" id="title" placeholder="Название трека">
    <input type="text" id="artist" placeholder="Исполнитель">
    
    <label>Ссылка на обложку (URL):</label>
    <input type="text" id="cover-url" placeholder="https://site.com/photo.jpg">
    
    <label>Ссылка на MP3 (URL):</label>
    <input type="text" id="audio-url" placeholder="https://site.com/song.mp3">
    
    <label>Текст (секунды|текст):</label>
    <textarea id="lyrics-raw" rows="5" placeholder="0|Интро...&#10;15|Первая строка"></textarea>
    
    <button class="btn" onclick="saveTrack()" id="upload-btn">Добавить в базу</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBXsLSl_6HNpLm3TqPTjkTRqo62gb2j968",
        authDomain: "m-flow-65777.firebaseapp.com",
        projectId: "m-flow-65777",
        storageBucket: "m-flow-65777.firebasestorage.app",
        messagingSenderId: "598827175490",
        appId: "1:598827175490:web:26618e76510f296f7267db",
        measurementId: "G-MF2YM53NQS"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function saveTrack() {
        const title = document.getElementById('title').value;
        const artist = document.getElementById('artist').value;
        const coverUrl = document.getElementById('cover-url').value;
        const audioUrl = document.getElementById('audio-url').value;
        const lyricsRaw = document.getElementById('lyrics-raw').value;

        if(!title || !artist || !coverUrl || !audioUrl) return alert("Заполни все поля ссылками!");

        const btn = document.getElementById('upload-btn');
        btn.disabled = true;

        try {
            const lyrics = lyricsRaw.split('\n').filter(l => l.includes('|')).map(l => {
                const [t, text] = l.split('|');
                return { t: parseInt(t), text: text.trim() };
            });

            await db.collection('tracks').add({
                title, artist, coverUrl, audioUrl, lyrics, 
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            alert("Трек добавлен по ссылке!");
            location.reload();
        } catch(e) { 
            alert("Ошибка базы данных: " + e.message); 
            btn.disabled = false; 
        }
    }
</script>
</body>
</html>
